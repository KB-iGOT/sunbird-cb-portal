<div class="blue-bg">
<div class="flex flex-col box-height">
  <div class="assessment-container">
  <div class="assessment-stats-count">
    <div class="flex flex-row justify-end">
      <div class="start-assessment-cta flex flex-row butto_box end">
        <!-- <ng-container
        *ngIf="questionTYP.PRACTICE_RESOURCE === quizCategory && (quizResponse?.children && quizResponse?.children?.length > 0)">
        <div class="quest_btn">
          <a mat-button (click)="action('retake')">
            Try Again
          </a>
        </div>
        </ng-container>  -->
        <ng-container>
        <div class="quest_btn" *ngIf="quizResponse">
          <a mat-button (click)="action('retake')">
            {{ 'playerbrief.tryAgain' | translate }}
          </a>
        </div>
        <!-- <div class="quest_btn-blue">
          <a mat-button (click)="action('retake')">
            {{ 'playerbrief.finish' | translate }}
          </a>
        </div> -->
        </ng-container> 
        <!-- <ng-container
        *ngIf="questionTYP.PRACTICE_RESOURCE === quizCategory && (quizResponse?.children && quizResponse?.children?.length > 0)">
        <div class="text-white  quest_btn_finish">
          <a mat-button (click)="action('retake')" class="width-1-1 text-white">
            Finish
          </a>
        </div>
        </ng-container>        -->
      </div>    
    </div>   
  </div>  
</div>

<div class="flex auto-w result_main">
  <!-- <div class="flex flex-1 max-w relative result_image_box">
    <div class="flex percent-div">
      <div class="flex flex-1 flex-column flex-center center">
        <ng-container *ngIf="questionTYP.FINAL_ASSESSMENT === quizCategory && quizResponse && !quizResponse?.isInProgress">
          <div *ngIf="isPassed && percentage === 100" class="msg-box">
            <mat-icon  class="ws-mat-green-2-text transform15 margin-top-m">check_circle</mat-icon>
            <span class="mat-body-3 ws-mat-black60-text margin-top-s text-block">{{levelText || 'Passed'}}</span>
            <span class="mat-body-2 ws-mat-default-text">{{(percentage || 0) | number: '1.2-2'}}%</span>
            <span class="mat-body-2 ws-mat-black60-text"> {{ 'quizresult.score' | translate }}</span>
            <span class="mat-body-2 text-block">{{ 'quizresult.hurray' | translate }}</span>
            <span class="mat-body-2 ws-mat-black60-text text-block attempt-text">{{ 'quizresult.passMsg1' | translate }}</span>
          </div>

          <div *ngIf="isPassed && percentage < 100" class="msg-box">
            <mat-icon  class="ws-mat-green-2-text transform15 margin-top-m ">check_circle</mat-icon>
            <span class="mat-body-3 ws-mat-black60-text margin-top-s text-block">{{levelText || 'Passed'}}</span>
            <span class="mat-body-2 ws-mat-default-text">{{(percentage || 0) | number: '1.2-2'}}%
              <span class="mat-body-2 ws-mat-black60-text"> {{ 'quizresult.score' | translate }}</span>
            </span>
            <span class="mat-body-2 ws-mat-black60-text text-block attempt-text">{{ 'quizresult.passMsg2' | translate }}</span>
          </div>

          <div *ngIf="!isPassed" class="msg-box">
            <mat-icon class="ws-mat-red-text msg-icon transform15 margin-top-m">highlight_off</mat-icon>
            <span class="mat-body-3 ws-mat-black60-text margin-top-s text-block">{{levelText || 'Failed'}}</span>
            <span class="mat-body-2 ws-mat-default-text">{{(percentage || 0) | number: '1.2-2'}}%</span>
            <span class="mat-body-2 ws-mat-black60-text"> {{ 'quizresult.score' | translate }}</span>
            <span class="mat-body-2 ws-mat-black60-text text-block attempt-text">{{ 'quizresult.passMsg3' | translate }}</span>
          </div>
        </ng-container>
        <ng-container *ngIf="questionTYP.PRACTICE_RESOURCE === quizCategory">
          <mat-icon class="ws-mat-green-2-text transform15 margin-top-m">check_box</mat-icon>
          <span class="ws-mat-black60-text margin-top-s padding-s attempt-text">{{ 'Well done, Keep learning!'}}</span>
        </ng-container>
      </div>
    </div>
    <img class="flex-1 result_image" [src]="staticImage" alt="exam image" />
  </div> -->
  <div class="flex flex-1 flex-column result_text_box border-custom">
    <div class="flex flex-1 flex-column flex-wrap margin-top-m">
      <!-- <ng-container *ngIf="!(quizResponse)">
        <div class="flex flex-1 flex-center text-center flex-middle">
          <span class="mat-heading" i18n>{{ 'quizresult.bePatienWhileWeCalculate' | translate }}</span>
          <mat-spinner></mat-spinner>
        </div>
      </ng-container> -->
      <ng-container *ngIf="quizResponse && quizResponse?.isInProgress">
        <div class="flex flex-row flex-center text-center flex-middle margin-top-xl">
          <!-- <span class="mat-heading" i18n>We are not able to fetch the result</span> -->
          <span class="mat-heading" i18n>{{ 'quizresult.submittedSucessfull' | translate }}</span>
        </div>
        <div class="flex flex-row flex-center text-center flex-middle margin-top-xl">
          <button mat-button  class="ws-mat-primary-background text-white m-w padding-xs" (click)="retryResult()">
            <mat-icon>refresh</mat-icon> {{ 'quizresult.retry' | translate }}</button>
        </div>
      </ng-container>
      <ng-container *ngIf="checkRes()">
        <div class="flex flex-row flex-center text-center flex-middle margin-top-xl">
          <span class="mat-heading" i18n><mat-icon class="font-size-50">warning</mat-icon></span>
        </div>
        <div class="flex flex-row flex-center text-center flex-middle margin-top-m padding-left-l">
          <span class="mat-heading" i18n>{{quizResponse}}</span>
        </div>
        <div class="flex flex-row flex-center text-center flex-middle margin-top-m padding-left-l">
          <span class="mat-heading" i18n>{{ 'quizresult.pleaseContactSystemAdmin' | translate }}</span>
        </div>
      </ng-container>
      <ng-container>  
        <div *ngIf="questionTYP.PRACTICE_RESOURCE === quizCategory">
          <div class="flex flex-col justify-center align-center success-message-result">
              <div><img src="assets/icons/final-assessment/practice-assessment-badge.svg"></div>
              <div class="mat-subheading-2">{{'quizresult.passMdg4' | translate}}</div>
          </div>
        </div>
        <div *ngIf="questionTYP.FINAL_ASSESSMENT === quizCategory && quizResponse" class="flex flex-col justify-center align-center success-message-result">
          <ng-container *ngIf="isPassed && percentage === 100">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="37 -5 120 100" width="120">
              
              <path  class="progress-clr" d="M55,90
                      A55,55 0 1,1 140,90"
                    style="fill:none;stroke-width:8px"
                    />
            </svg>
            <div style="position:relative; top: -60px; left: 0px;">
                <div class="percentage">{{(percentage || 0) | number: '1.2-2'}}%</div>
                <div class="level-text">{{levelText || 'Passed'}}</div>
            </div>
            <div class="mat-subheading-2 message">{{'quizresult.passMsg1' | translate}}</div>
          </ng-container>
          <ng-container *ngIf="isPassed && percentage < 100">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="37 -5 120 100" width="108">
              
              <path  class="progress-clr" d="M55,90
                      A55,55 0 1,1 140,90"
                    style="fill:none;stroke-width:8px"
                    />
            </svg>
            <div style="position:relative; top: -60px; left: 0px;">
                <div class="percentage">{{(percentage || 0) | number: '1.2-2'}}%</div>
                <div class="level-text">{{levelText || ('playerbrief.passed' | translate)}}</div>
            </div>
            <div class="mat-subheading-2 message">{{'quizresult.passMsg2' | translate}}</div>
          </ng-container>
          <ng-container *ngIf="!isPassed  && quizResponse">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="37 -5 120 100" width="108">
              
              <path  class="progress-red-clr" d="M55,90
                      A55,55 0 1,1 140,90"
                    style="fill:none;stroke-width:8px"
                    />
            </svg>
            <!-- <div class="circular-progress-container">
              <div class="circular-progress">
                {{updateProgress(percentage)}}
              </div>
            </div> -->
            <div style="position:relative; top: -60px; left: 0px;">
                <div class="percentage">{{(percentage || 0) | number: '1.2-2'}}%</div>
                <div class="level-text">{{levelText || ('playerbrief.failed' | translate)}}</div>
            </div>
            <div class="mat-subheading-2 message">{{'playerbrief.tryAgainMessage' | translate}}</div>
          </ng-container>
        </div>     
        <mat-card class="result_box_time_container" *ngIf="quizResponse">
          <div class="flex flex-row justify-between response_box">        
            <div class="stats-label">
              <!-- <div><img src="assets/icons/final-assessment/timer.svg"></div> -->
              <div><img src="assets/icons/final-assessment/assessment-done.svg"></div>
              <div class="ml-2"> {{'playerbrief.totalQuestions' | translate}}: </div>
            </div>
            <div class="stats-label">
              <!-- <div><img src="assets/icons/final-assessment/assessment-done.svg"></div> -->
              <div class="ml-2">{{quizResponse?.total}} {{'playerbrief.questions' | translate}}</div>
            </div>
          </div>
        </mat-card> 
        <ng-container *ngFor="let _parts of quizResponse?.children; let i = index">
          <mat-card *ngIf="_parts" class="result_box">
            <mat-card-title class="section-title">
              <span class="mat-subheading-1" *ngIf="!isOnlySection">{{'Section ' + (i+1)}}</span>
              <span class="mat-subheading-2" *ngIf="isOnlySection">{{'playerbrief.performanceSummary' | translate}}</span> 
            </mat-card-title>
            <mat-card-content class="flex flex-1 flex-column">
              <ng-container *ngFor="let _result of ['correct','inCorrect','incorrect','blank']">
                <ng-container *ngIf="_parts[_result]">
                  <ng-container *ngIf="_result == 'correct'" [ngTemplateOutlet]="testdetail" [ngTemplateOutletContext]="{data: {
                icon: 'done',
                isSVG: false,
                imgIcon: 'correct_arrow',
                colorClass: 'rgb(27, 76, 161)',
                text: _parts[_result] + ' '+translateLabels(' questionCorrectAnswered', 'playerbrief'),
                type: _result,
                sectionType: 'Section' + (i)+_result,
                children:_parts['children']}
              }"></ng-container>
                  <ng-container *ngIf="_result === 'inCorrect' || _result ===  'incorrect'" [ngTemplateOutlet]="incorrectDetail"
                    [ngTemplateOutletContext]="{ data:{
                icon: 'done',
                isSVG: false,
                imgIcon: 'blue-cross',
                colorClass: 'rgb(27, 76, 161)',
                text: _parts[_result] + ' '+translateLabels(' questionWrongAnswered', 'playerbrief'),
                type: _result,
                sectionType: 'Section' + (i)+_result,
                children:_parts['children']
              }}"></ng-container>
                  <ng-container *ngIf="_result == 'blank'" [ngTemplateOutlet]="detail" [ngTemplateOutletContext]="{data:{
                icon: 'done',
                isSVG: false,
                imgIcon: 'blue-question',
                colorClass: 'rgb(27, 76, 161)',
                text: _parts[_result] +' '+translateLabels(' questionUnAnswered', 'playerbrief'),
                type: _result,
                sectionType: 'Section' + (i)+_result,
                children:_parts['children']
              }}"></ng-container>
                </ng-container>
              </ng-container>
            </mat-card-content>
          </mat-card>
        </ng-container>
      </ng-container>
    </div>
    <!-- <ng-container
      *ngIf="questionTYP.PRACTICE_RESOURCE === quizCategory && (quizResponse?.children && quizResponse?.children?.length > 0)">
      <div class="flex flex-1 flex-center">
        <a mat-button (click)="action('retake')" class="width-1-1 text-white ws-mat-primary-background retake">
          {{ 'quizresult.retakeAssessment' | translate }}
        </a>
      </div>
    </ng-container> -->
  </div>
  <div class="flex flex-1 top-margin-63">
    <div class="p-4 w-full" [ngClass]="activeQuestionSet === 'answer' ? 'question-list-green' : (activeQuestionSet === 'wrong') ? 'question-list-red' : 'question-list-gray'" *ngIf="selectedQuestionData">
      <p class="question-section">{{selectedQuestionData.text}} </p>
      <div *ngIf="selectedQuestionData.children">
        <ng-container *ngFor="let question of selectedQuestionData.children;let i = index">
          <ng-container *ngIf="selectedQuestionData.type === question.result">
            <mat-accordion class="example-headers-align">
                  <mat-expansion-panel class="questionPanel bg-gray-accordian" hideToggle="true"  #example>
                    <mat-expansion-panel-header class="question-header">
                      <mat-panel-title class="mr-0">
                        <mat-panel-description class="panel-description">
                          <p>{{ 'practiceoverview.question' | translate }} {{i+1}}</p>
                          <mat-icon *ngIf="!example.expanded">add</mat-icon>
                          <mat-icon *ngIf="example.expanded">remove</mat-icon>
                        </mat-panel-description>
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                      <div>
                        <p class="display-ques">{{question.question}}</p>
                      </div>
                  </mat-expansion-panel>
            </mat-accordion>

        </ng-container>
      </ng-container>
      </div>
    </div>
  </div>
</div>
</div>
<ng-template #incorrectDetail let-data="data" >
  <mat-card [ngClass]="{'highlight': selectedQuestionData?.sectionType === data.sectionType}" class="flex customcard flex-jc-space-between cursor-pointer margin-top-xs bg-gray" (click)="getQuestionCount(data,'wrong')">
    <div class="flex">
      <!-- <mat-icon [style.color]="data.colorClass">{{data.icon}}</mat-icon> -->
      <img src="assets/icons/final-assessment/{{data.imgIcon}}.svg">
      <span class="mat-body-2 margin-left-xs">{{data.text}}</span>
    </div>
    <mat-icon *ngIf="selectedQuestionData?.sectionType !== data.sectionType">add</mat-icon>
    <mat-icon *ngIf="selectedQuestionData?.sectionType === data.sectionType">remove</mat-icon>
  </mat-card>
</ng-template>


<ng-template #detail let-data="data" >
  <mat-card [ngClass]="{'highlight': selectedQuestionData?.sectionType === data.sectionType}" class="flex customcard flex-jc-space-between cursor-pointer margin-top-xs bg-gray" (click)="getQuestionCount(data,'blank')">
    <div class="flex">
      <!-- <mat-icon [style.color]="data.colorClass">{{data.icon}}</mat-icon> -->
      <img src="assets/icons/final-assessment/{{data.imgIcon}}.svg">
      <span class="mat-body-2 margin-left-xs">{{data.text}}</span>
    </div>
    <mat-icon *ngIf="selectedQuestionData?.sectionType !== data.sectionType">add</mat-icon>
    <mat-icon *ngIf="selectedQuestionData?.sectionType === data.sectionType">remove</mat-icon>
  </mat-card>
</ng-template>

<ng-template #testdetail let-data="data" >
  <mat-card class="flex customcard flex-jc-space-between cursor-pointer margin-top-xs bg-gray" [ngClass]="{'highlight': selectedQuestionData?.sectionType === data.sectionType}" (click)="getQuestionCount(data,'answer')">
    <div class="flex">
      <!-- <mat-icon [style.color]="data.colorClass" *ngIf="!data.isSVG">{{data.icon}}</mat-icon> -->
      <!-- <img *ngIf="data.isSVG" [style.color]="data.colorClass" [src]="data.icon" alt="Assessment" class="margin-right-xs"> -->
      <img src="assets/icons/final-assessment/{{data.imgIcon}}.svg">
      <span class="mat-body-2 margin-left-xs">{{data.text}}</span>
    </div>
    <mat-icon *ngIf="selectedQuestionData?.sectionType !== data.sectionType">add</mat-icon>
    <mat-icon *ngIf="selectedQuestionData?.sectionType === data.sectionType">remove</mat-icon>
  </mat-card>
</ng-template>



